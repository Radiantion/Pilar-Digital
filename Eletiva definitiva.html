<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Mat√©rias</title>
    <!--
        Este script carrega o Tailwind CSS diretamente da internet.
        O Tailwind CSS √© uma ferramenta que nos ajuda a criar estilos visuais bonitos
        e que se adaptam a diferentes tamanhos de tela (celulares, tablets, computadores),
        sem precisarmos escrever muito c√≥digo CSS do zero.
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!--
        Este link carrega a fonte 'Inter' do Google Fonts.
        Fontes s√£o o estilo das letras. Usamos a 'Inter' para que o texto do site
        tenha uma apar√™ncia moderna e seja f√°cil de ler.
    -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!--
        Este link carrega o estilo visual do Quill.js.
        O Quill.js √© uma ferramenta JavaScript que transforma uma √°rea de texto simples
        num editor de texto mais avan√ßado, como os que usamos no Word ou no Google Docs,
        onde podemos colocar negrito, it√°lico, listas, etc.
    -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        /* ---------------------------------------------------- */
        /* ESTILOS CSS GERAIS E RESPONSIVOS (Regras visuais) */
        /* ---------------------------------------------------- */

        /*
            Define a fonte padr√£o 'Inter' para todo o texto do site,
            uma cor de fundo cinza bem claro para a p√°gina e
            uma cor de texto cinza escuro para a maioria dos elementos.
        */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* √â um tom de cinza-claro definido pelo Tailwind */
            color: #374151; /* √â um tom de cinza-escuro definido pelo Tailwind */
        }

        /*
            Estilos para o "cont√™iner" principal da nossa aplica√ß√£o.
            √â a caixa grande que envolve todo o conte√∫do do site.
            - `max-width: 1200px`: A caixa n√£o ser√° maior que 1200 pixels de largura.
            - `margin: 2rem auto`: Centraliza a caixa na tela e d√° um espa√ßamento em cima e em baixo.
            - `padding: 1.5rem`: Espa√ßamento interno para o conte√∫do n√£o ficar colado nas bordas da caixa.
            - `background-color: #ffffff`: Fundo branco para a caixa.
            - `border-radius: 0.75rem`: Deixa os cantos da caixa arredondados.
            - `box-shadow`: Adiciona uma sombra suave para dar um efeito de profundidade.
            - `width: calc(100% - 2rem)`: Em telas pequenas (como celulares), a caixa ocupa quase
              100% da largura, mas com 1rem de margem em cada lado para n√£o encostar nas bordas do aparelho.
        */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: #ffffff;
            border-radius: 0.75rem; /* cantos arredondados */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* sombra */
            width: calc(100% - 2rem); /* para que funcione bem em celulares */
        }

        /*
            Estilos espec√≠ficos para a √°rea de edi√ß√£o de texto do Quill.js.
            - `min-height: 150px`: Garante que a caixa do editor tenha pelo menos 150 pixels de altura.
            - `border-radius: 0.5rem`: Deixa os cantos do editor arredondados.
        */
        .quill-container .ql-editor {
            min-height: 150px;
            border-radius: 0.5rem;
        }

        /*
            Estilos para o conte√∫do de texto exibido nas mat√©rias (classe 'prose').
            Isso ajuda a formatar o texto de forma agrad√°vel para a leitura,
            como em um artigo de blog.
        */
        .prose {
            font-size: 1rem; /* Tamanho da letra padr√£o */
            line-height: 1.75rem; /* Espa√ßamento entre as linhas para facilitar a leitura */
            color: #374151; /* Cor padr√£o para o texto */
        }
        /* Estilos para t√≠tulos dentro do conte√∫do das mat√©rias */
        .prose h1, .prose h2, .prose h3, .prose h4 {
            color: #1f2937; /* Cor mais escura para os t√≠tulos */
            margin-top: 1.5rem; /* Espa√ßamento acima do t√≠tulo */
            margin-bottom: 1rem; /* Espa√ßamento abaixo do t√≠tulo */
        }
        /* Estilos para par√°grafos dentro do conte√∫do das mat√©rias */
        .prose p {
            margin-bottom: 1rem; /* Espa√ßamento abaixo de cada par√°grafo */
        }
        /* Estilos para listas (numeradas ou com marcadores) */
        .prose ul, .prose ol {
            margin-top: 1rem;
            margin-bottom: 1rem;
            padding-left: 1.5rem; /* Recuo para os itens da lista */
        }
        /* Estilos para cada item de uma lista */
        .prose li {
            margin-bottom: 0.5rem;
        }
        /* Estilos para links dentro do conte√∫do das mat√©rias */
        .prose a {
            color: #2563eb; /* Cor azul para os links */
            text-decoration: underline; /* Links sublinhados */
        }

        /*
            Regra de responsividade para telas pequenas (smartphones).
            - `@media (max-width: 640px)`: Estes estilos s√≥ ser√£o aplicados se a largura da tela for
              igual ou menor que 640 pixels.
            - `.auth-buttons-group`: Seleciona o grupo de bot√µes na tela de login/registro.
            - `@apply flex-col space-y-3`: Faz com que os bot√µes se alinhem em coluna e tenham um
              espa√ßamento entre eles quando a tela for pequena.
            - `@apply w-full`: Faz com que cada bot√£o ocupe toda a largura dispon√≠vel na tela pequena.
        */
        @media (max-width: 640px) {
            .auth-buttons-group {
                /* Organiza os bot√µes em uma coluna com espa√ßo entre eles */
                @apply flex-col space-y-3;
            }
            .auth-buttons-group button {
                /* Faz com que cada bot√£o ocupe a largura total */
                @apply w-full;
            }
        }

        #toggle-mode {
  position: fixed;
  top: 20px;
  right: 20px;
  background-color: #2563eb; /* azul */
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  z-index: 1001;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

#toggle-mode:hover {
  background-color: #1e40af; /* azul mais escuro */
}

body.dark-mode {
  background-color: #121212; /* fundo geral quase preto */
  color: #f5f5f5; /* texto principal bem claro */
}

body.dark-mode .container {
  background-color: #1e1e1e; /* bloco com contraste sutil */
  color: #f5f5f5;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
}

body.dark-mode .prose h1,
body.dark-mode .prose h2,
body.dark-mode .prose h3,
body.dark-mode .prose h4 {
  color: #ffffff; /* t√≠tulos bem brancos */
}

body.dark-mode .prose p {
  color: #d4d4d4; /* par√°grafos com cinza claro */
}

body.dark-mode .prose a {
  color: #9ca3af; /* link cinza-azulado discreto */
  text-decoration: underline;
}

body.dark-mode .prose a:hover {
  color: #e5e7eb; /* link fica mais claro no hover */
}

/* Campos de formul√°rio no modo escuro */
body.dark-mode input,
body.dark-mode textarea {
  background-color: #1f1f1f;
  color: #f5f5f5;
  border: 1px solid #3f3f46;
}

body.dark-mode input:focus,
body.dark-mode textarea:focus {
  border-color: #9ca3af;
  outline: none;
}

/* Bot√µes */
body.dark-mode button {
  background-color: #3f3f46;
  color: #ffffff;
}

body.dark-mode button:hover {
  background-color: #52525b;
}

/* Bot√£o de alternar modo */
body.dark-mode #toggle-mode {
  background-color: #3f3f46;
  color: #ffffff;
}

body.dark-mode #toggle-mode:hover {
  background-color: #52525b;
}

body.dark-mode h1 {
  color: #9ca3af; 
}
body.dark-mode h2 {
  color: #7e8591; 
}
body.dark-mode h3 {
  color: #7e8591; 
}
form div p{
    color: #72757c;
}

    </style>
</head>
<body class="min-h-screen flex items-center justify-center py-8">
    <button id="toggle-mode">üåô Alternar Modo</button>
    <div class="container">
        <!-- T√≠tulo principal do portal, centralizado e com margem inferior -->
        <h1 class="text-3xl md:text-4xl font-bold text-center mb-6 text-gray-800">Portal de Eletiva</h1>

        <!-- ---------------------------------------------------- -->
        <!-- VIEW DE AUTENTICA√á√ÉO (LOGIN / REGISTRO) -->
        <!-- Esta parte da p√°gina √© vis√≠vel apenas quando nenhum usu√°rio est√° logado. -->
        <!-- Ela permite que professores fa√ßam login, se registrem ou entrem como visitante. -->
        <!-- ---------------------------------------------------- -->
        <div id="auth-view" class="space-y-6">
            <!-- Grupo de bot√µes para alternar entre as op√ß√µes de autentica√ß√£o -->
            <div class="text-center flex justify-center flex-wrap gap-3 auth-buttons-group">
                <!-- Bot√£o 'Login': Quando clicado, mostra o formul√°rio de login. -->
                <button id="show-login-btn" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium shadow-md hover:shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all duration-300 ease-in-out">Login</button>
                <!-- Bot√£o 'Registrar': Quando clicado, mostra o formul√°rio de registro. -->
                <button id="show-register-btn" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium shadow-md hover:shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all duration-300 ease-in-out">Registrar</button>
                <!-- Bot√£o 'Entrar como Visitante': Permite acesso de visualiza√ß√£o sem login/registro. -->
                <button id="guest-login-btn" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-300 ease-in-out">Entrar como Visitante</button>
            </div>

            <!-- Formul√°rio de Login: Onde professores inserem suas credenciais. -->
            <form id="login-form" class="bg-gray-50 p-6 rounded-xl shadow">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700">Entrar</h2>
                <div class="mb-4">
                    <label for="login-username" class="block text-gray-700 text-sm font-bold mb-2">Usu√°rio:</label>
                    <!-- Campo para o nome de usu√°rio do login -->
                    <input type="text" id="login-username" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full transition-all duration-200" placeholder="Seu nome de usu√°rio" required>
                </div>
                <div class="mb-6">
                    <label for="login-password" class="block text-gray-700 text-sm font-bold mb-2">Senha:</label>
                    <!-- Campo para a senha do login -->
                    <input type="password" id="login-password" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full transition-all duration-200" placeholder="Sua senha" required>
                </div>
                <!-- Bot√£o para enviar o formul√°rio de login -->
                <button type="submit" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-300 ease-in-out w-full">Login</button>
                <!-- Mensagem de erro para login (inicialmente oculta) -->
                <p id="login-message" class="text-red-500 text-center mt-3 hidden text-sm"></p>
            </form>

            <!-- Formul√°rio de Registro: Onde novos professores podem criar uma conta. (inicialmente oculto) -->
            <form id="register-form" class="bg-gray-50 p-6 rounded-xl shadow hidden">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700">Registrar</h2>
                <div class="mb-4">
                    <label for="register-username" class="block text-gray-700 text-sm font-bold mb-2">Usu√°rio:</label>
                    <!-- Campo para o nome de usu√°rio do registro -->
                    <input type="text" id="register-username" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full transition-all duration-200" placeholder="Crie um nome de usu√°rio" required>
                </div>
                <div class="mb-4">
                    <label for="register-password" class="block text-gray-700 text-sm font-bold mb-2">Senha:</label>
                    <!-- Campo para a senha do registro -->
                    <input type="password" id="register-password" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full transition-all duration-200" placeholder="Crie uma senha" required>
                </div>
                <div class="mb-6">
                    <label for="register-confirm-password" class="block text-gray-700 text-sm font-bold mb-2">Confirmar Senha:</label>
                    <!-- Campo para confirmar a senha do registro -->
                    <input type="password" id="register-confirm-password" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full transition-all duration-200" placeholder="Confirme sua senha" required>
                </div>
                <!-- Bot√£o para enviar o formul√°rio de registro -->
                <button type="submit" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-300 ease-in-out w-full">Registrar</button>
                <!-- Mensagem de erro ou sucesso para registro (inicialmente oculta) -->
                <p id="register-message" class="text-red-500 text-center mt-3 hidden text-sm"></p>
            </form>
        </div>

        <!-- ---------------------------------------------------- -->
        <!-- VIEW DO PAINEL (DASHBOARD) - PROFESSOR / VISITANTE -->
        <!-- Esta parte da p√°gina √© vis√≠vel depois que o usu√°rio faz login (ou entra como visitante). -->
        <!-- Mostra as mat√©rias dispon√≠veis e op√ß√µes de gest√£o/visualiza√ß√£o. -->
        <!-- ---------------------------------------------------- -->
        <div id="dashboard-view" class="hidden">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <!-- Mostra uma mensagem de boas-vindas com o nome do usu√°rio logado (ou "Visitante") -->
                <h2 class="text-xl md:text-2xl font-semibold text-gray-700">Bem-vindo(a), <span id="current-user-display"></span>!</h2>
                <!-- Bot√£o para sair da conta ou do modo visitante -->
                <button id="logout-btn" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium shadow-md hover:shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all duration-300 ease-in-out w-full md:w-auto">Sair</button>
            </div>

            <!-- Bot√£o para adicionar uma nova mat√©ria (vis√≠vel APENAS para professores) -->
            <div class="mb-6 text-center">
                <button id="add-subject-btn" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-300 ease-in-out w-full md:w-auto">Adicionar Nova Mat√©ria</button>
            </div>

            <!-- T√≠tulo da se√ß√£o de mat√©rias (muda dependendo se √© professor ou visitante) -->
            <h3 class="text-xl font-semibold mb-4 text-gray-700" id="subjects-list-title">Minhas Mat√©rias:</h3>
            <!-- Cont√™iner onde as "cartas" de cada mat√©ria ser√£o exibidas. -->
            <!-- O layout √© uma grade que se adapta: 1 coluna em celular, 2 em tablet, 3 em desktop. -->
            <div id="subjects-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- As mat√©rias ser√£o carregadas aqui dinamicamente pelo JavaScript -->
            </div>
            <!-- Mensagens para quando n√£o h√° mat√©rias (uma para professor, outra para visitante) -->
            <p id="no-subjects-message" class="text-center text-gray-600 mt-8 hidden">Nenhuma mat√©ria adicionada ainda. Clique em "Adicionar Nova Mat√©ria" para come√ßar!</p>
            <p id="no-public-subjects-message" class="text-center text-gray-600 mt-8 hidden">Nenhuma mat√©ria dispon√≠vel para visualiza√ß√£o.</p>
        </div>

        <!-- ---------------------------------------------------- -->
        <!-- VIEW DO FORMUL√ÅRIO DE MAT√âRIA (ADICIONAR / EDITAR) -->
        <!-- Esta parte √© vis√≠vel quando um professor est√° a criar uma mat√©ria nova -->
        <!-- ou a editar uma mat√©ria existente. -->
        <!-- ---------------------------------------------------- -->
        <div id="subject-form-view" class="hidden bg-gray-50 p-6 rounded-xl shadow">
            <!-- T√≠tulo do formul√°rio (muda para "Adicionar Nova Mat√©ria" ou "Editar Mat√©ria") -->
            <h2 id="subject-form-title" class="text-2xl font-semibold mb-4 text-gray-700"></h2>
            <form id="subject-form" class="space-y-4">
                <!-- Campo oculto para guardar o ID da mat√©ria. Usado apenas na edi√ß√£o para saber qual mat√©ria alterar. -->
                <input type="hidden" id="subject-id">
                <div>
                    <label for="subject-title" class="block text-gray-700 text-sm font-bold mb-2">T√≠tulo da Mat√©ria:</label>
                    <!-- Campo para o t√≠tulo da mat√©ria -->
                    <input type="text" id="subject-title" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full transition-all duration-200" required>
                </div>
                <div>
                    <label for="subject-description" class="block text-gray-700 text-sm font-bold mb-2">Descri√ß√£o:</label>
                    <!-- √Årea de texto para a descri√ß√£o da mat√©ria -->
                    <textarea id="subject-description" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full transition-all duration-200 h-24" required></textarea>
                </div>

                <h3 class="text-xl font-semibold mt-6 mb-4 text-gray-700">Conte√∫do da Mat√©ria:</h3>
                <!-- Cont√™iner onde os blocos de conte√∫do (texto e v√≠deo) ser√£o adicionados para a mat√©ria. -->
                <div id="content-blocks-container" class="space-y-4 border border-gray-300 rounded-md p-4 bg-white">
                    <!-- Mensagem padr√£o quando n√£o h√° blocos de conte√∫do adicionados -->
                    <p class="text-gray-500 text-center py-4">Nenhum conte√∫do adicionado. Adicione blocos de texto ou v√≠deo abaixo.</p>
                </div>

                <!-- Bot√µes para adicionar novos blocos de conte√∫do -->
                <div class="flex flex-col sm:flex-row justify-around mt-6 gap-3">
                    <button type="button" id="add-text-block-btn" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium shadow-md hover:shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all duration-300 ease-in-out w-full sm:w-auto">Adicionar Texto</button>
                    <button type="button" id="add-video-block-btn" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium shadow-md hover:shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all duration-300 ease-in-out w-full sm:w-auto">Adicionar V√≠deo</button>
                </div>

                <!-- Bot√µes para salvar as altera√ß√µes na mat√©ria ou cancelar a edi√ß√£o -->
                <div class="flex flex-col sm:flex-row justify-between mt-8 gap-3">
                    <button type="submit" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-300 ease-in-out w-full sm:w-auto">Salvar Mat√©ria</button>
                    <button type="button" id="cancel-subject-form-btn" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium shadow-md hover:shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all duration-300 ease-in-out w-full sm:w-auto">Cancelar</button>
                </div>
            </form>
        </div>

        <!-- ---------------------------------------------------- -->
        <!-- VIEW DE DETALHES DA MAT√âRIA (VISUALIZA√á√ÉO P√öBLICA) -->
        <!-- Esta parte √© vis√≠vel quando qualquer usu√°rio (professor ou visitante) -->
        <!-- clica em "Ver Mat√©ria" para ver o conte√∫do completo. -->
        <!-- ---------------------------------------------------- -->
        <div id="subject-detail-view" class="hidden">
            <!-- Bot√£o para voltar para o painel de mat√©rias -->
            <button id="back-to-dashboard-from-detail-btn" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium shadow-md hover:shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all duration-300 ease-in-out mb-4">Voltar para o Painel</button>
            <!-- T√≠tulo e descri√ß√£o da mat√©ria que est√° sendo visualizada -->
            <h2 id="detail-subject-title" class="text-2xl md:text-3xl font-bold mb-2 text-gray-800"></h2>
            <p id="detail-subject-description" class="text-gray-600 mb-6"></p>
            <!-- √Årea onde os blocos de conte√∫do (texto formatado e v√≠deos incorporados) ser√£o exibidos. -->
            <div id="detail-content-area" class="space-y-8">
                <!-- Os blocos de conte√∫do ser√£o carregados aqui dinamicamente pelo JavaScript -->
            </div>
        </div>
    </div>

    <!--
        Este script carrega a biblioteca Quill.js.
        Ela √© usada para criar o editor de texto avan√ßado onde os professores podem
        adicionar e formatar o conte√∫do das suas mat√©rias.
    -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <!-- ---------------------------------------------------- -->
    <!-- L√ìGICA JAVASCRIPT DA APLICA√á√ÉO -->
    <!-- Este bloco cont√©m todo o c√≥digo JavaScript que faz o site funcionar. -->
    <!-- Ele lida com o login, registro, adi√ß√£o de mat√©rias, etc. -->
    <!-- ---------------------------------------------------- -->
    <script>
        // Vari√°veis de estado global para gerenciar o que est√° acontecendo na aplica√ß√£o.
        // 'let' significa que o valor desta vari√°vel pode mudar.

        let currentUser = null; // Guarda informa√ß√µes sobre o usu√°rio que est√° logado (professor ou visitante).
                                // Se for 'null', ningu√©m est√° logado.

        let currentSubjectId = null; // Guarda o ID da mat√©ria que um professor est√° a editar no momento.
                                     // Ajuda a saber se estamos a criar uma nova mat√©ria ou a mudar uma existente.

        let quillEditors = {}; // Um objeto que guarda as inst√¢ncias do editor Quill.js.
                               // Cada bloco de texto na mat√©ria ter√° seu pr√≥prio editor Quill.
                               // Usamos um objeto para encontr√°-los facilmente pelo ID do bloco.

        /* --- Fun√ß√µes de Utilit√°rio para localStorage --- */
        // O 'localStorage' √© como uma pequena mem√≥ria no seu navegador.
        // Ele permite que o site guarde informa√ß√µes (como usu√°rios e mat√©rias) no seu computador,
        // e essas informa√ß√µes ficam guardadas mesmo depois de fechar e reabrir o navegador.
        // IMPORTANTE: Isto N√ÉO √â um banco de dados real. √â s√≥ para demonstra√ß√£o.
        // Para um site de verdade, precisar√≠amos de um servidor e um banco de dados de verdade.

        /**
         * Fun√ß√£o: loadData(key)
         * O que faz: Pega dados que foram guardados no localStorage.
         * @param {string} key - √â o nome (chave) do dado que queremos pegar (ex: 'teachers', 'subjects').
         * @returns {any} O dado encontrado (transformado de texto para objeto) ou 'null' se n√£o encontrar nada.
         */
        function loadData(key) {
            const data = localStorage.getItem(key); // Pega a informa√ß√£o do localStorage pelo 'key'.
            return data ? JSON.parse(data) : null; // Se encontrou, transforma de texto (JSON) para objeto; sen√£o, √© nulo.
        }

        /**
         * Fun√ß√£o: saveData(key, data)
         * O que faz: Guarda dados no localStorage.
         * @param {string} key - √â o nome (chave) que vamos dar ao dado para o encontrar mais tarde.
         * @param {any} data - O dado que queremos guardar (pode ser um n√∫mero, texto, objeto, etc.).
         */
        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data)); // Transforma o dado em texto (JSON) e guarda no localStorage.
        }

        /**
         * Fun√ß√£o: generateUniqueId()
         * O que faz: Cria um c√≥digo √∫nico para cada coisa (mat√©ria, bloco de texto/v√≠deo).
         * Isto √© importante para que cada item tenha um identificador exclusivo.
         * @returns {string} Um c√≥digo √∫nico, como 'id-1678888888888-abcde'.
         */
        function generateUniqueId() {
            // Usa a data e hora atual (Date.now()) e um n√∫mero aleat√≥rio (Math.random()) para criar um ID √∫nico.
            return 'id-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        }

        /* --- Fun√ß√µes de Autentica√ß√£o (Simulada) --- */
        // Estas fun√ß√µes simulam como um sistema de login e registro funcionaria.
        // Lembre-se: Para um site real, a seguran√ßa aqui precisaria ser MUITO mais robusta!

        /**
         * Fun√ß√£o: hashPassword(password)
         * O que faz: "Embaralha" a senha para que n√£o seja guardada em texto simples.
         * IMPORTANTE: Em um site real, nunca far√≠amos isso no navegador!
         * Usar√≠amos um servidor para "embaralhar" a senha de forma segura (com t√©cnicas como bcrypt).
         * Esta √© apenas uma demonstra√ß√£o MUITO SIMPLES: ela s√≥ inverte a senha.
         * Exemplo: se a senha for "minhasenha", vira "ahnesahmim".
         * @param {string} password - A senha que queremos "embaralhar".
         * @returns {string} A senha "embaralhada".
         */
        function hashPassword(password) {
            return password.split('').reverse().join(''); // Divide a senha em letras, inverte a ordem, e junta de novo.
        }

        /**
         * Fun√ß√£o: registerUser(username, password)
         * O que faz: Tenta criar uma nova conta de professor.
         * @param {string} username - O nome de usu√°rio escolhido pelo professor.
         * @param {string} password - A senha escolhida pelo professor.
         * @returns {boolean} 'true' se a conta foi criada com sucesso, 'false' se o nome de usu√°rio j√° existe.
         */
        function registerUser(username, password) {
            const users = loadData('teachers') || []; // Carrega a lista de professores guardada, ou cria uma lista vazia.
            if (users.find(u => u.username === username)) {
                return false; // Se j√° existe um usu√°rio com esse nome, n√£o permite o registro.
            }
            // Adiciona o novo professor √† lista, com a senha "embaralhada" e dizendo que n√£o √© um visitante.
            users.push({ username, passwordHash: hashPassword(password), isGuest: false });
            saveData('teachers', users); // Guarda a lista atualizada de professores no localStorage.
            return true; // Registro bem-sucedido.
        }

        /**
         * Fun√ß√£o: loginUser(username, password)
         * O que faz: Tenta fazer o login de um professor.
         * @param {string} username - O nome de usu√°rio que o professor digitou.
         * @param {string} password - A senha que o professor digitou.
         * @returns {boolean} 'true' se o login foi bem-sucedido, 'false' se as informa√ß√µes estiverem erradas.
         */
        function loginUser(username, password) {
            const users = loadData('teachers') || [];
            // Procura na lista de professores por um que combine com o nome de usu√°rio E a senha "embaralhada".
            const user = users.find(u => u.username === username && u.passwordHash === hashPassword(password));
            if (user) {
                // Se encontrou o usu√°rio, guarda as informa√ß√µes dele na 'sessionStorage'.
                // 'sessionStorage' √© como o 'localStorage', mas os dados S√ì duram enquanto o navegador
                // ou a aba estiverem abertos. Quando fecha, a informa√ß√£o √© apagada.
                sessionStorage.setItem('currentUser', JSON.stringify(user));
                currentUser = user; // Define a vari√°vel global 'currentUser' com os dados do professor logado.
                return true; // Login bem-sucedido.
            }
            return false; // Usu√°rio ou senha incorretos.
        }

        /**
         * Fun√ß√£o: loginAsGuest()
         * O que faz: Permite que um usu√°rio entre no site como "Visitante".
         * Visitantes podem ver as mat√©rias, mas n√£o podem criar ou editar.
         */
        function loginAsGuest() {
            // Cria um objeto de usu√°rio simples, marcando-o como visitante.
            currentUser = { username: 'Visitante', isGuest: true };
            sessionStorage.setItem('currentUser', JSON.stringify(currentUser)); // Guarda na sess√£o.
            currentUserDisplay.textContent = currentUser.username; // Atualiza o nome de usu√°rio exibido na tela.
            showView('dashboard-view'); // Muda para a tela do painel.
            renderSubjectsList(); // Mostra as mat√©rias (todas) para o visitante.
        }

        /**
         * Fun√ß√£o: logoutUser()
         * O que faz: Desloga o usu√°rio atual (professor ou visitante).
         * Limpa as informa√ß√µes da sess√£o e volta para a tela de login/registro.
         */
        function logoutUser() {
            sessionStorage.removeItem('currentUser'); // Remove as informa√ß√µes do usu√°rio da sess√£o.
            currentUser = null; // Limpa a vari√°vel global 'currentUser'.
            showView('auth-view'); // Mostra novamente a tela de autentica√ß√£o.
        }

        /* --- Fun√ß√µes de Gerenciamento de Mat√©rias --- */
        // Estas fun√ß√µes lidam com a cria√ß√£o, visualiza√ß√£o, edi√ß√£o e exclus√£o de mat√©rias.

        /**
         * Fun√ß√£o: getSubjectsToDisplay()
         * O que faz: Decide quais mat√©rias devem ser mostradas na lista.
         * Se o usu√°rio for um 'Visitante', mostra TODAS as mat√©rias.
         * Se o usu√°rio for um 'Professor', mostra APENAS as mat√©rias que ele criou.
         * @returns {Array<Object>} Uma lista (array) de objetos de mat√©ria.
         */
        function getSubjectsToDisplay() {
            const allSubjects = loadData('subjects') || []; // Carrega todas as mat√©rias guardadas, ou cria uma lista vazia.
            if (currentUser && currentUser.isGuest) {
                return allSubjects; // Se for visitante, devolve todas as mat√©rias.
            } else if (currentUser) {
                // Se for professor, filtra as mat√©rias para mostrar s√≥ as que ele criou.
                return allSubjects.filter(s => s.teacherUsername === currentUser.username);
            }
            return []; // Se ningu√©m estiver logado (o que n√£o deveria acontecer neste fluxo), retorna uma lista vazia.
        }

        /**
         * Fun√ß√£o: addSubject(title, description, contentBlocks)
         * O que faz: Adiciona uma nova mat√©ria √† lista.
         * @param {string} title - O t√≠tulo da nova mat√©ria.
         * @param {string} description - A descri√ß√£o da nova mat√©ria.
         * @param {Array<Object>} contentBlocks - Uma lista de blocos de conte√∫do (texto e/ou v√≠deo) da mat√©ria.
         * @returns {Object} O objeto da mat√©ria que acabou de ser adicionada.
         */
        function addSubject(title, description, contentBlocks) {
            const allSubjects = loadData('subjects') || [];
            const newSubject = {
                id: generateUniqueId(), // Cria um ID √∫nico para esta nova mat√©ria.
                teacherUsername: currentUser.username, // Guarda qual professor criou esta mat√©ria.
                title, // T√≠tulo da mat√©ria.
                description, // Descri√ß√£o da mat√©ria.
                contentBlocks: contentBlocks || [], // Os blocos de texto/v√≠deo. Se nenhum, um array vazio.
                createdAt: new Date().toISOString() // A data e hora que a mat√©ria foi criada.
            };
            allSubjects.push(newSubject); // Adiciona a nova mat√©ria √† lista geral.
            saveData('subjects', allSubjects); // Salva a lista atualizada de mat√©rias no localStorage.
            return newSubject;
        }

        /**
         * Fun√ß√£o: updateSubject(id, title, description, contentBlocks)
         * O que faz: Atualiza uma mat√©ria existente no localStorage.
         * @param {string} id - O ID da mat√©ria que queremos atualizar.
         * @param {string} title - O novo t√≠tulo da mat√©ria.
         * @param {string} description - A nova descri√ß√£o da mat√©ria.
         * @param {Array<Object>} contentBlocks - A nova lista de blocos de conte√∫do.
         * @returns {boolean} 'true' se a mat√©ria foi encontrada e atualizada, 'false' caso contr√°rio.
         */
        function updateSubject(id, title, description, contentBlocks) {
            const allSubjects = loadData('subjects') || [];
            // Encontra qual mat√©ria na lista corresponde ao ID e se ela pertence ao professor logado.
            const index = allSubjects.findIndex(s => s.id === id && s.teacherUsername === currentUser.username);
            if (index !== -1) { // Se encontrou a mat√©ria...
                // Atualiza as informa√ß√µes da mat√©ria no array.
                allSubjects[index].title = title;
                allSubjects[index].description = description;
                allSubjects[index].contentBlocks = contentBlocks;
                saveData('subjects', allSubjects); // Salva a lista atualizada no localStorage.
                return true; // Mat√©ria atualizada com sucesso.
            }
            return false; // Mat√©ria n√£o encontrada ou n√£o pertence a este professor.
        }

        /**
         * Fun√ß√£o: deleteSubject(id)
         * O que faz: Remove uma mat√©ria do localStorage.
         * @param {string} id - O ID da mat√©ria a ser removida.
         * @returns {boolean} 'true' se a mat√©ria foi removida, 'false' caso contr√°rio.
         */
        function deleteSubject(id) {
            let allSubjects = loadData('subjects') || [];
            const initialLength = allSubjects.length;
            // Cria uma nova lista de mat√©rias, excluindo aquela com o ID e que pertence ao professor.
            allSubjects = allSubjects.filter(s => !(s.id === id && s.teacherUsername === currentUser.username));
            saveData('subjects', allSubjects); // Salva a nova lista (sem a mat√©ria deletada).
            return allSubjects.length < initialLength; // Retorna 'true' se uma mat√©ria foi realmente removida.
        }

        /**
         * Fun√ß√£o: getSubjectById(id)
         * O que faz: Encontra e retorna uma mat√©ria espec√≠fica usando o seu ID.
         * Usado quando o usu√°rio clica em "Ver Mat√©ria".
         * @param {string} id - O ID da mat√©ria a ser encontrada.
         * @returns {Object|null} O objeto da mat√©ria encontrada ou 'null' se n√£o encontrar.
         */
        function getSubjectById(id) {
            const allSubjects = loadData('subjects') || [];
            return allSubjects.find(s => s.id === id); // Procura a mat√©ria pelo ID.
        }

        /* --- Refer√™ncias aos Elementos da UI --- */
        // Aqui, selecionamos todos os peda√ßos importantes do HTML usando seus 'id's.
        // Assim, o JavaScript pode "conversar" com esses peda√ßos da p√°gina, mostrando ou escondendo-os,
        // mudando o texto, etc.

        const authView = document.getElementById('auth-view'); // A √°rea de login/registro.
        const dashboardView = document.getElementById('dashboard-view'); // O painel principal (onde as mat√©rias s√£o listadas).
        const subjectFormView = document.getElementById('subject-form-view'); // O formul√°rio para criar/editar mat√©rias.
        const subjectDetailView = document.getElementById('subject-detail-view'); // A tela para ver os detalhes de uma mat√©ria.

        const loginForm = document.getElementById('login-form'); // O formul√°rio de login.
        const registerForm = document.getElementById('register-form'); // O formul√°rio de registro.
        const loginMessage = document.getElementById('login-message'); // A caixa de mensagem para login.
        const registerMessage = document.getElementById('register-message'); // A caixa de mensagem para registro.
        const showLoginBtn = document.getElementById('show-login-btn'); // Bot√£o para mostrar o formul√°rio de login.
        const showRegisterBtn = document.getElementById('show-register-btn'); // Bot√£o para mostrar o formul√°rio de registro.
        const guestLoginBtn = document.getElementById('guest-login-btn'); // Bot√£o para entrar como visitante.
        const logoutBtn = document.getElementById('logout-btn'); // Bot√£o de sair.
        const addSubjectBtn = document.getElementById('add-subject-btn'); // Bot√£o para adicionar nova mat√©ria.
        const subjectsList = document.getElementById('subjects-list'); // Onde as cartas das mat√©rias s√£o exibidas.
        const noSubjectsMessage = document.getElementById('no-subjects-message'); // Mensagem: "Nenhuma mat√©ria (professor)".
        const noPublicSubjectsMessage = document.getElementById('no-public-subjects-message'); // Mensagem: "Nenhuma mat√©ria (visitante)".
        const subjectsListTitle = document.getElementById('subjects-list-title'); // T√≠tulo da lista de mat√©rias.
        const subjectForm = document.getElementById('subject-form'); // O formul√°rio completo de mat√©ria.
        const subjectFormTitle = document.getElementById('subject-form-title'); // T√≠tulo do formul√°rio de mat√©ria.
        const subjectIdInput = document.getElementById('subject-id'); // Campo oculto para o ID da mat√©ria.
        const subjectTitleInput = document.getElementById('subject-title'); // Campo para o t√≠tulo da mat√©ria.
        const subjectDescriptionInput = document.getElementById('subject-description'); // Campo para a descri√ß√£o da mat√©ria.
        const contentBlocksContainer = document.getElementById('content-blocks-container'); // Onde os blocos de conte√∫do s√£o adicionados.
        const addTextBlockBtn = document.getElementById('add-text-block-btn'); // Bot√£o para adicionar bloco de texto.
        const addVideoBlockBtn = document.getElementById('add-video-block-btn'); // Bot√£o para adicionar bloco de v√≠deo.
        const cancelSubjectFormBtn = document.getElementById('cancel-subject-form-btn'); // Bot√£o para cancelar edi√ß√£o de mat√©ria.
        const backToDashboardFromDetailBtn = document.getElementById('back-to-dashboard-from-detail-btn'); // Bot√£o para voltar do detalhe da mat√©ria.
        const detailSubjectTitle = document.getElementById('detail-subject-title'); // T√≠tulo da mat√©ria na tela de detalhes.
        const detailSubjectDescription = document.getElementById('detail-subject-description'); // Descri√ß√£o da mat√©ria na tela de detalhes.
        const detailContentArea = document.getElementById('detail-content-area'); // √Årea onde o conte√∫do da mat√©ria √© exibido.
        const currentUserDisplay = document.getElementById('current-user-display'); // Onde o nome do usu√°rio logado √© mostrado.

        /* --- Fun√ß√µes de UI e Renderiza√ß√£o --- */
        // Estas fun√ß√µes s√£o respons√°veis por mudar o que voc√™ v√™ na tela.

        /**
         * Fun√ß√£o: showView(viewId)
         * O que faz: Mostra uma parte espec√≠fica da p√°gina e esconde todas as outras.
         * √â como trocar de tela dentro da mesma p√°gina.
         * @param {string} viewId - O 'id' da parte da p√°gina que queremos mostrar (ex: 'auth-view', 'dashboard-view').
         */
        function showView(viewId) {
            // Primeiro, esconde todas as se√ß√µes principais da p√°gina, adicionando a classe 'hidden' do Tailwind.
            [authView, dashboardView, subjectFormView, subjectDetailView].forEach(view => {
                view.classList.add('hidden');
            });
            // Depois, mostra a se√ß√£o que queremos, removendo a classe 'hidden'.
            document.getElementById(viewId).classList.remove('hidden');
        }

        /**
         * Fun√ß√£o: renderSubjectsList()
         * O que faz: Desenha (renderiza) a lista de mat√©rias no painel principal.
         * Ela verifica se √© um professor ou visitante e mostra as mat√©rias e bot√µes corretos.
         */
        function renderSubjectsList() {
            subjectsList.innerHTML = ''; // Limpa qualquer mat√©ria que j√° esteja na lista, para redesenhar do zero.
            const subjects = getSubjectsToDisplay(); // Pega a lista de mat√©rias que devem ser mostradas para o usu√°rio atual.

            // Esconde as mensagens de "nenhuma mat√©ria" antes de verificar se h√° mat√©rias.
            noSubjectsMessage.classList.add('hidden');
            noPublicSubjectsMessage.classList.add('hidden');

            if (currentUser && currentUser.isGuest) {
                // Se o usu√°rio atual for um 'Visitante':
                subjectsListTitle.textContent = 'Todas as Mat√©rias Dispon√≠veis:'; // Muda o t√≠tulo da lista.
                addSubjectBtn.classList.add('hidden'); // Esconde o bot√£o "Adicionar Nova Mat√©ria", pois visitante n√£o pode criar.
                if (subjects.length === 0) { // Se n√£o houver mat√©rias para mostrar...
                    noPublicSubjectsMessage.classList.remove('hidden'); // Mostra a mensagem espec√≠fica para visitantes.
                }
            } else {
                // Se o usu√°rio atual for um 'Professor':
                subjectsListTitle.textContent = 'Minhas Mat√©rias:'; // Muda o t√≠tulo da lista para "Minhas Mat√©rias".
                addSubjectBtn.classList.remove('hidden'); // Mostra o bot√£o "Adicionar Nova Mat√©ria".
                if (subjects.length === 0) { // Se o professor n√£o tiver mat√©rias...
                    noSubjectsMessage.classList.remove('hidden'); // Mostra a mensagem espec√≠fica para professores.
                }
            }

            // Para cada mat√©ria na lista que deve ser mostrada:
            subjects.forEach(subject => {
                // Cria um elemento 'div' que ser√° o "cart√£o" de cada mat√©ria.
                const subjectCard = document.createElement('div');
                // Adiciona estilos ao cart√£o da mat√©ria (fundo branco, padding, cantos arredondados, sombra).
                subjectCard.className = 'bg-white p-6 rounded-xl shadow-md space-y-3 border border-gray-200';
                subjectCard.innerHTML = `
                    <h4 class="text-xl font-semibold text-gray-800">${subject.title}</h4>
                    <p class="text-gray-600 text-sm">${subject.description.substring(0, 100)}${subject.description.length > 100 ? '...' : ''}</p>
                    <div class="flex flex-wrap gap-2 mt-4">
                        <!-- Bot√£o "Ver Mat√©ria": Sempre vis√≠vel, permite ver o conte√∫do completo. -->
                        <button class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium shadow-md hover:shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all duration-300 ease-in-out btn-view-subject" data-id="${subject.id}">Ver Mat√©ria</button>
                        <!--
                            Bot√£o "Editar": Vis√≠vel APENAS para professores E se a mat√©ria for DELE.
                            O 'data-id' guarda o ID da mat√©ria para saber qual editar.
                        -->
                        ${!currentUser.isGuest && subject.teacherUsername === currentUser.username ? `<button class="bg-gray-200 text-gray-800 px-6 py-2 rounded-full font-medium shadow-md hover:shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all duration-300 ease-in-out btn-edit-subject" data-id="${subject.id}">Editar</button>` : ''}
                        <!--
                            Bot√£o "Deletar": Vis√≠vel APENAS para professores E se a mat√©ria for DELE.
                            O 'data-id' guarda o ID da mat√©ria para saber qual deletar.
                        -->
                        ${!currentUser.isGuest && subject.teacherUsername === currentUser.username ? `<button class="bg-gradient-to-r from-red-600 to-red-700 text-white px-6 py-2 rounded-full font-medium shadow-md hover:shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all duration-300 ease-in-out btn-delete-subject" data-id="${subject.id}">Deletar</button>` : ''}
                    </div>
                `;
                subjectsList.appendChild(subjectCard); // Adiciona o cart√£o da mat√©ria √† lista na p√°gina.
            });

            // Adiciona "ouvintes de eventos" (event listeners) para os bot√µes de a√ß√£o nos cart√µes.
            // Quando um bot√£o √© clicado, o c√≥digo dentro da fun√ß√£o √© executado.

            document.querySelectorAll('.btn-view-subject').forEach(button => {
                button.addEventListener('click', (e) => {
                    const subjectId = e.target.dataset.id; // Pega o ID da mat√©ria do bot√£o clicado.
                    renderSubjectDetail(subjectId); // Chama a fun√ß√£o para mostrar os detalhes da mat√©ria.
                });
            });

            // Apenas adiciona os ouvintes para "Editar" e "Deletar" se o usu√°rio N√ÉO for um visitante.
            if (!currentUser.isGuest) {
                document.querySelectorAll('.btn-edit-subject').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const subjectId = e.target.dataset.id;
                        editSubject(subjectId); // Chama a fun√ß√£o para abrir o formul√°rio de edi√ß√£o.
                    });
                });
                document.querySelectorAll('.btn-delete-subject').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const subjectId = e.target.dataset.id;
                        // Mostra uma caixa de confirma√ß√£o antes de deletar.
                        // (Em um site real, esta confirma√ß√£o seria mais bonita e personalizada, n√£o um pop-up nativo do navegador.)
                        if (window.confirm('Tem certeza que deseja deletar esta mat√©ria?')) {
                            deleteSubject(subjectId); // Chama a fun√ß√£o para deletar a mat√©ria.
                            renderSubjectsList(); // Redesenha a lista de mat√©rias ap√≥s a exclus√£o.
                        }
                    });
                });
            }
        }

        /**
         * Fun√ß√£o: renderSubjectForm(subject)
         * O que faz: Prepara e mostra o formul√°rio que um professor usa para adicionar uma nova mat√©ria
         * ou para editar uma mat√©ria que j√° existe.
         * @param {Object} [subject=null] - Se estiver a editar, este √© o objeto da mat√©ria a ser editada.
         * Se for uma nova mat√©ria, este par√¢metro √© 'null'.
         */
        function renderSubjectForm(subject = null) {
            quillEditors = {}; // Limpa as refer√™ncias aos editores Quill.js antigos.
            // Limpa o cont√™iner de blocos de conte√∫do e coloca a mensagem inicial.
            contentBlocksContainer.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhum conte√∫do adicionado. Adicione blocos de texto ou v√≠deo abaixo.</p>';

            if (subject) { // Se o par√¢metro 'subject' n√£o for nulo, significa que estamos a EDITAR uma mat√©ria.
                subjectFormTitle.textContent = 'Editar Mat√©ria'; // Muda o t√≠tulo do formul√°rio para "Editar Mat√©ria".
                subjectIdInput.value = subject.id; // Preenche o campo oculto com o ID da mat√©ria.
                subjectTitleInput.value = subject.title; // Preenche o t√≠tulo da mat√©ria.
                subjectDescriptionInput.value = subject.description; // Preenche a descri√ß√£o da mat√©ria.
                currentSubjectId = subject.id; // Guarda o ID da mat√©ria que est√° sendo editada.
                // Se a mat√©ria j√° tiver blocos de conte√∫do, adiciona-os ao formul√°rio para edi√ß√£o.
                if (subject.contentBlocks.length > 0) {
                    contentBlocksContainer.innerHTML = ''; // Remove a mensagem inicial se houver conte√∫do.
                    subject.contentBlocks.forEach(block => {
                        addContentBlockToForm(block.type, block.content, block.id); // Adiciona cada bloco.
                    });
                }
            } else { // Se o par√¢metro 'subject' for nulo, significa que estamos a ADICIONAR uma mat√©ria nova.
                subjectFormTitle.textContent = 'Adicionar Nova Mat√©ria'; // Muda o t√≠tulo do formul√°rio.
                subjectIdInput.value = ''; // Limpa o campo de ID (nova mat√©ria n√£o tem ID ainda).
                subjectTitleInput.value = ''; // Limpa o t√≠tulo.
                subjectDescriptionInput.value = ''; // Limpa a descri√ß√£o.
                currentSubjectId = null; // Zera o ID da mat√©ria em edi√ß√£o.
            }
            showView('subject-form-view'); // Mostra a tela do formul√°rio de mat√©ria.
        }

        /**
         * Fun√ß√£o: addContentBlockToForm(type, content, id)
         * O que faz: Adiciona um novo "bloco" de conte√∫do (pode ser texto ou v√≠deo) ao formul√°rio da mat√©ria.
         * @param {string} type - O tipo de bloco: 'text' (para texto) ou 'video' (para v√≠deo).
         * @param {string} [content=''] - O conte√∫do inicial para o bloco (texto HTML para blocos de texto, URL para blocos de v√≠deo). √â opcional.
         * @param {string} [id=generateUniqueId()] - Um ID √∫nico para este bloco espec√≠fico. √â opcional, cria um novo se n√£o for dado.
         */
        function addContentBlockToForm(type, content = '', id = generateUniqueId()) {
            // Remove a mensagem "Nenhum conte√∫do adicionado..." se ela estiver vis√≠vel.
            const noContentMessage = contentBlocksContainer.querySelector('p.text-gray-500');
            if (noContentMessage) {
                noContentMessage.remove();
            }

            const blockDiv = document.createElement('div'); // Cria uma nova caixa (div) para o bloco de conte√∫do.
            blockDiv.className = 'content-block p-4 border border-gray-200 rounded-md bg-gray-50 relative';
            blockDiv.dataset.id = id; // Guarda o ID do bloco nesta caixa.
            blockDiv.dataset.type = type; // Guarda o tipo de bloco ('text' ou 'video') nesta caixa.

            let innerHtml = ''; // Vari√°vel para guardar o HTML interno do bloco.
            if (type === 'text') { // Se for um bloco de TEXTO:
                innerHtml = `
                    <h5 class="font-medium text-gray-700 mb-2">Bloco de Texto</h5>
                    <!-- Cria um espa√ßo para o editor Quill.js -->
                    <div id="quill-editor-${id}" class="quill-container bg-white border border-gray-300 rounded-md"></div>
                `;
            } else if (type === 'video') { // Se for um bloco de V√çDEO:
                innerHtml = `
                    <h5 class="font-medium text-gray-700 mb-2">Bloco de V√≠deo</h5>
                    <!-- Cria um campo para o usu√°rio colar a URL do v√≠deo -->
                    <input type="url" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full transition-all duration-200 video-url-input" placeholder="Cole a URL do YouTube/Vimeo" value="${content}">
                `;
            }

            // Adiciona o conte√∫do HTML e um bot√£o 'X' para remover este bloco.
            blockDiv.innerHTML = `
                ${innerHtml}
                <!-- Bot√£o 'X' para remover o bloco de conte√∫do. -->
                <button type="button" class="bg-red-500 hover:bg-red-600 text-white p-1 rounded-full text-xs shadow-none hover:shadow-none transform-none hover:scale-110 transition-all duration-200 absolute top-2 right-2" onclick="removeContentBlock(this)">X</button>
            `;
            contentBlocksContainer.appendChild(blockDiv); // Adiciona a nova caixa do bloco ao cont√™iner de blocos.

            // Se for um bloco de TEXTO, inicializa o editor Quill.js nele.
            if (type === 'text') {
                const quillEditorDiv = document.getElementById(`quill-editor-${id}`);
                const quill = new Quill(quillEditorDiv, {
                    theme: 'snow', // 'snow' √© o tema visual padr√£o do Quill (com barra de ferramentas).
                    modules: {
                        toolbar: [ // Define os bot√µes que aparecer√£o na barra de ferramentas do editor.
                            [{ 'header': [1, 2, 3, false] }], // T√≠tulos (H1, H2, H3)
                            ['bold', 'italic', 'underline', 'strike'], // Negrito, It√°lico, Sublinhado, Riscado
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }], // Listas ordenadas e n√£o ordenadas
                            [{ 'align': [] }], // Alinhamento do texto
                            ['link'], // Adicionar link
                            ['clean'] // Limpar formata√ß√£o
                        ]
                    }
                });
                quillEditors[id] = quill; // Guarda a inst√¢ncia do editor Quill para este bloco, usando seu ID como chave.
                if (content) {
                    quill.clipboard.dangerouslyPasteHTML(content); // Se j√° houver conte√∫do, coloca-o no editor.
                }
            }
        }

        /**
         * Fun√ß√£o: removeContentBlock(button)
         * O que faz: Remove um bloco de conte√∫do (texto ou v√≠deo) do formul√°rio da mat√©ria.
         * Isso acontece quando o usu√°rio clica no bot√£o 'X' de um bloco.
         * @param {HTMLElement} button - O bot√£o 'X' que foi clicado.
         */
        function removeContentBlock(button) {
            const blockDiv = button.closest('.content-block'); // Encontra a caixa (div) que cont√©m o bloco de conte√∫do.
            const blockId = blockDiv.dataset.id; // Pega o ID desse bloco.
            delete quillEditors[blockId]; // Remove a inst√¢ncia do Quill.js associada a este bloco (se for de texto).
            blockDiv.remove(); // Remove a caixa (div) inteira do HTML, tirando o bloco da tela.

            // Se, ap√≥s remover o bloco, n√£o houver mais nenhum bloco de conte√∫do, mostra a mensagem inicial.
            if (contentBlocksContainer.children.length === 0) {
                contentBlocksContainer.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhum conte√∫do adicionado. Adicione blocos de texto ou v√≠deo abaixo.</p>';
            }
        }

        /**
         * Fun√ß√£o: collectContentBlocksData()
         * O que faz: Re√∫ne todas as informa√ß√µes dos blocos de conte√∫do que est√£o no formul√°rio da mat√©ria.
         * Pega o texto dos editores Quill e as URLs dos campos de v√≠deo.
         * @returns {Array<Object>} Uma lista (array) de objetos, onde cada objeto representa um bloco de conte√∫do
         * com seu ID, tipo ('text' ou 'video') e o conte√∫do.
         */
        function collectContentBlocksData() {
            const blocksData = []; // Cria uma lista vazia para guardar os dados dos blocos.
            // Procura por todas as caixas (divs) que representam blocos de conte√∫do.
            document.querySelectorAll('#content-blocks-container .content-block').forEach(blockDiv => {
                const type = blockDiv.dataset.type; // Pega o tipo do bloco ('text' ou 'video').
                const id = blockDiv.dataset.id; // Pega o ID do bloco.
                let content = ''; // Vari√°vel para guardar o conte√∫do do bloco.

                if (type === 'text') { // Se for um bloco de TEXTO:
                    const quill = quillEditors[id]; // Pega a inst√¢ncia do editor Quill.js para este bloco.
                    if (quill) {
                        content = quill.root.innerHTML; // Pega todo o conte√∫do HTML que est√° no editor.
                    }
                } else if (type === 'video') { // Se for um bloco de V√çDEO:
                    // Pega o texto que o usu√°rio digitou no campo de URL do v√≠deo.
                    content = blockDiv.querySelector('.video-url-input').value;
                }
                blocksData.push({ id, type, content }); // Adiciona as informa√ß√µes deste bloco √† lista.
            });
            return blocksData; // Retorna a lista completa de blocos de conte√∫do.
        }

        /**
         * Fun√ß√£o: renderSubjectDetail(subjectId)
         * O que faz: Mostra os detalhes completos de uma mat√©ria na tela de visualiza√ß√£o.
         * Exibe o texto formatado e incorpora os v√≠deos do YouTube/Vimeo.
         * @param {string} subjectId - O ID da mat√©ria que ser√° visualizada.
         */
        function renderSubjectDetail(subjectId) {
            const subject = getSubjectById(subjectId); // Pega o objeto da mat√©ria completa pelo ID.
            if (!subject) { // Se a mat√©ria n√£o for encontrada (por algum erro no ID).
                window.alert('Mat√©ria n√£o encontrada.'); // Mostra uma mensagem de erro.
                showView('dashboard-view'); // Volta para o painel.
                return; // Para a execu√ß√£o da fun√ß√£o.
            }

            detailSubjectTitle.textContent = subject.title; // Coloca o t√≠tulo da mat√©ria na tela de detalhes.
            detailSubjectDescription.textContent = subject.description; // Coloca a descri√ß√£o da mat√©ria.
            detailContentArea.innerHTML = ''; // Limpa qualquer conte√∫do anterior na √°rea de detalhes.

            // Para cada bloco de conte√∫do da mat√©ria (texto ou v√≠deo):
            subject.contentBlocks.forEach(block => {
                const blockDiv = document.createElement('div'); // Cria uma nova caixa (div) para este bloco.
                blockDiv.className = 'bg-white p-6 rounded-xl shadow-sm border border-gray-100'; // Estiliza a caixa.

                if (block.type === 'text') { // Se for um bloco de TEXTO:
                    // Adiciona o conte√∫do HTML do texto. A classe 'prose' garante uma boa formata√ß√£o.
                    blockDiv.innerHTML = `<div class="prose max-w-none">${block.content}</div>`;
                } else if (block.type === 'video') { // Se for um bloco de V√çDEO:
                    // Tenta encontrar o ID do v√≠deo na URL para poder incorpor√°-lo (YouTube ou Vimeo).
                    const youtubeMatch = block.content.match(/(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
                    const vimeoMatch = block.content.match(/(?:vimeo\.com\/(?:video\/|channels\/(?:\w+\/)?|groups\/(?:\w+\/)?|)\S*)([0-9]+)/);

                    let embedSrc = ''; // Vari√°vel para guardar o link de incorpora√ß√£o do v√≠deo.
                    if (youtubeMatch && youtubeMatch[1]) {
                        embedSrc = `https://www.youtube.com/embed/${youtubeMatch[1]}`; // Se for YouTube, cria o link de embed.
                    } else if (vimeoMatch && vimeoMatch[1]) {
                        embedSrc = `https://player.vimeo.com/video/${vimeoMatch[1]}`; // Se for Vimeo, cria o link de embed.
                    }

                    if (embedSrc) { // Se conseguiu gerar um link de incorpora√ß√£o v√°lido:
                        blockDiv.innerHTML = `
                            <!-- Cria uma caixa responsiva para o v√≠deo, mantendo a propor√ß√£o 16:9 -->
                            <div class="aspect-video w-full rounded-md overflow-hidden">
                                <iframe
                                    src="${embedSrc}"
                                    frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen
                                    class="w-full h-full"
                                ></iframe>
                            </div>
                        `;
                    } else {
                        // Se a URL do v√≠deo for inv√°lida ou n√£o suportada, mostra uma mensagem de erro.
                        blockDiv.innerHTML = `<p class="text-red-500">URL de v√≠deo inv√°lida ou n√£o suportada: ${block.content}</p>`;
                    }
                }
                detailContentArea.appendChild(blockDiv); // Adiciona a caixa do bloco √† √°rea de detalhes da mat√©ria.
            });
            showView('subject-detail-view'); // Mostra a tela de detalhes da mat√©ria.
        }

        /**
         * Fun√ß√£o: editSubject(subjectId)
         * O que faz: Inicia o processo de edi√ß√£o de uma mat√©ria.
         * Carrega os dados da mat√©ria no formul√°rio para o professor poder alter√°-los.
         * @param {string} subjectId - O ID da mat√©ria que o professor quer editar.
         */
        function editSubject(subjectId) {
            // Primeiro, verifica se a mat√©ria existe E se ela pertence ao professor logado.
            const subject = getSubjectsToDisplay().find(s => s.id === subjectId && s.teacherUsername === currentUser.username);
            if (subject) { // Se a mat√©ria foi encontrada e pertence ao professor:
                renderSubjectForm(subject); // Chama a fun√ß√£o para preencher e mostrar o formul√°rio com os dados da mat√©ria.
            } else { // Se a mat√©ria n√£o for encontrada ou n√£o pertencer a este professor:
                window.alert('Mat√©ria n√£o encontrada ou voc√™ n√£o tem permiss√£o para editar.'); // Mostra uma mensagem de erro.
                renderSubjectsList(); // Redesenha a lista de mat√©rias (para garantir que s√≥ as suas apare√ßam).
                showView('dashboard-view'); // Volta para o painel.
            }
        }

        /* --- Gerenciamento de Eventos (Event Listeners) --- */
        // Estas s√£o as "regras" que dizem o que o site deve fazer
        // quando algo acontece (ex: um bot√£o √© clicado).

        // Quando o bot√£o 'Login' √© clicado na tela de autentica√ß√£o:
        showLoginBtn.addEventListener('click', () => {
            loginForm.classList.remove('hidden'); // Mostra o formul√°rio de login.
            registerForm.classList.add('hidden'); // Esconde o formul√°rio de registro.
            loginMessage.classList.add('hidden'); // Esconde qualquer mensagem antiga de login.
            registerMessage.classList.add('hidden'); // Esconde qualquer mensagem antiga de registro.
            loginForm.reset(); // Limpa os campos do formul√°rio de login.
        });

        // Quando o bot√£o 'Registrar' √© clicado na tela de autentica√ß√£o:
        showRegisterBtn.addEventListener('click', () => {
            registerForm.classList.remove('hidden'); // Mostra o formul√°rio de registro.
            loginForm.classList.add('hidden'); // Esconde o formul√°rio de login.
            registerMessage.classList.add('hidden'); // Esconde qualquer mensagem antiga de registro.
            loginMessage.classList.add('hidden'); // Esconde qualquer mensagem antiga de login.
            registerForm.reset(); // Limpa os campos do formul√°rio de registro.
        });

        // Quando o bot√£o 'Entrar como Visitante' √© clicado:
        guestLoginBtn.addEventListener('click', loginAsGuest); // Chama a fun√ß√£o para logar como visitante.

        // Quando o formul√°rio de Login √© enviado (bot√£o 'Login' clicado):
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault(); // Impede que a p√°gina recarregue (comportamento padr√£o de formul√°rios).
            const username = document.getElementById('login-username').value; // Pega o nome de usu√°rio digitado.
            const password = document.getElementById('login-password').value; // Pega a senha digitada.
            if (loginUser(username, password)) { // Tenta fazer o login. Se for bem-sucedido...
                currentUserDisplay.textContent = currentUser.username; // Atualiza o nome do usu√°rio no painel.
                showView('dashboard-view'); // Mostra a tela do painel.
                renderSubjectsList(); // Carrega e exibe as mat√©rias do usu√°rio logado.
            } else { // Se o login falhou...
                loginMessage.textContent = 'Usu√°rio ou senha inv√°lidos.'; // Mostra uma mensagem de erro.
                loginMessage.classList.remove('hidden'); // Torna a mensagem vis√≠vel.
            }
        });

        // Quando o formul√°rio de Registro √© enviado (bot√£o 'Registrar' clicado):
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault(); // Impede que a p√°gina recarregue.
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;

            if (password !== confirmPassword) { // Verifica se as senhas digitadas s√£o iguais.
                registerMessage.textContent = 'As senhas n√£o coincidem.';
                registerMessage.classList.remove('hidden');
                registerMessage.classList.remove('text-green-600'); // Garante que a cor seja vermelha para erro.
                registerMessage.classList.add('text-red-500');
                return; // Para a fun√ß√£o aqui.
            }
            if (password.length < 6) { // Verifica se a senha tem pelo menos 6 caracteres.
                registerMessage.textContent = 'A senha deve ter pelo menos 6 caracteres.';
                registerMessage.classList.remove('hidden');
                registerMessage.classList.remove('text-green-600');
                registerMessage.classList.add('text-red-500');
                return; // Para a fun√ß√£o aqui.
            }

            if (registerUser(username, password)) { // Tenta registrar o novo usu√°rio. Se for bem-sucedido...
                registerMessage.textContent = 'Registro bem-sucedido! Fa√ßa login agora.';
                registerMessage.classList.remove('hidden');
                registerMessage.classList.remove('text-red-500'); // Garante que a cor seja verde para sucesso.
                registerMessage.classList.add('text-green-600');
                registerForm.reset(); // Limpa os campos do formul√°rio de registro.
                showLoginBtn.click(); // Automaticamente muda para o formul√°rio de login para o usu√°rio logar.
            } else { // Se o registro falhou (ex: usu√°rio j√° existe)...
                registerMessage.textContent = 'Nome de usu√°rio j√° existe.';
                registerMessage.classList.remove('hidden');
                registerMessage.classList.remove('text-green-600');
                registerMessage.classList.add('text-red-500');
            }
        });

        // Quando o bot√£o 'Sair' √© clicado:
        logoutBtn.addEventListener('click', logoutUser); // Chama a fun√ß√£o para deslogar o usu√°rio.

        // Quando o bot√£o 'Adicionar Nova Mat√©ria' √© clicado no painel:
        addSubjectBtn.addEventListener('click', () => renderSubjectForm()); // Chama a fun√ß√£o para mostrar o formul√°rio de mat√©ria (para adicionar nova).

        // Quando o formul√°rio de Mat√©ria √© enviado (bot√£o 'Salvar Mat√©ria' clicado):
        subjectForm.addEventListener('submit', (e) => {
            e.preventDefault(); // Impede que a p√°gina recarregue.
            const id = subjectIdInput.value; // Pega o ID da mat√©ria (se estiver editando).
            const title = subjectTitleInput.value; // Pega o t√≠tulo.
            const description = subjectDescriptionInput.value; // Pega a descri√ß√£o.
            const contentBlocks = collectContentBlocksData(); // Pega todos os blocos de conte√∫do do formul√°rio.

            if (id) { // Se o ID existe, significa que estamos EDITANDO uma mat√©ria.
                updateSubject(id, title, description, contentBlocks); // Chama a fun√ß√£o para atualizar.
            } else { // Se o ID n√£o existe, significa que estamos ADICIONANDO uma nova mat√©ria.
                addSubject(title, description, contentBlocks); // Chama a fun√ß√£o para adicionar.
            }
            showView('dashboard-view'); // Volta para a tela do painel.
            renderSubjectsList(); // Atualiza a lista de mat√©rias no painel.
        });

        // Quando o bot√£o 'Adicionar Texto' √© clicado no formul√°rio da mat√©ria:
        addTextBlockBtn.addEventListener('click', () => addContentBlockToForm('text')); // Adiciona um novo bloco de texto.

        // Quando o bot√£o 'Adicionar V√≠deo' √© clicado no formul√°rio da mat√©ria:
        addVideoBlockBtn.addEventListener('click', () => addContentBlockToForm('video')); // Adiciona um novo bloco de v√≠deo.

        // Quando o bot√£o 'Cancelar' √© clicado no formul√°rio da mat√©ria:
        cancelSubjectFormBtn.addEventListener('click', () => {
            // Pede uma confirma√ß√£o ao usu√°rio para evitar perda de dados n√£o salvos.
            if (window.confirm('Qualquer altera√ß√£o n√£o salva ser√° perdida. Deseja realmente cancelar?')) {
                showView('dashboard-view'); // Volta para o painel.
                renderSubjectsList(); // Atualiza a lista.
            }
        });

        // Quando o bot√£o 'Voltar para o Painel' √© clicado na tela de detalhes da mat√©ria:
        backToDashboardFromDetailBtn.addEventListener('click', () => {
            showView('dashboard-view'); // Volta para o painel.
            renderSubjectsList(); // Atualiza a lista.
        });

        /* --- Inicializa√ß√£o da Aplica√ß√£o --- */
        // Este √© o c√≥digo que executa quando a p√°gina √© carregada pela primeira vez.

        // Garante que o script s√≥ comece a funcionar depois que toda a p√°gina HTML estiver pronta.
        document.addEventListener('DOMContentLoaded', () => {
            const storedUser = sessionStorage.getItem('currentUser'); // Tenta pegar informa√ß√µes de um usu√°rio logado anteriormente.
            if (storedUser) { // Se encontrou um usu√°rio guardado na sess√£o...
                currentUser = JSON.parse(storedUser); // Carrega as informa√ß√µes do usu√°rio.
                currentUserDisplay.textContent = currentUser.username; // Mostra o nome do usu√°rio no painel.
                showView('dashboard-view'); // Mostra a tela do painel.
                renderSubjectsList(); // Carrega e exibe as mat√©rias para esse usu√°rio.
            } else { // Se n√£o h√° usu√°rio logado na sess√£o...
                showView('auth-view'); // Mostra a tela de autentica√ß√£o.
                showLoginBtn.click(); // E por padr√£o, mostra o formul√°rio de login.
            }
        });
        
    </script>
    <script>
  const toggleBtn = document.getElementById('toggle-mode');
  toggleBtn.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    
    // Muda o √≠cone do bot√£o üåô/‚òÄÔ∏è
    toggleBtn.textContent = document.body.classList.contains('dark-mode')
      ? '‚òÄÔ∏è Modo Claro'
      : 'üåô Modo Escuro';
  });
</script>

</body>
</html>
